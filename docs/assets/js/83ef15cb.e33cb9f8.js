"use strict";(self.webpackChunkstreamsheets=self.webpackChunkstreamsheets||[]).push([[13470],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>d});var o=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=o.createContext({}),c=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},m=function(e){var n=c(e.components);return o.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(t),d=a,g=p["".concat(s,".").concat(d)]||p[d]||u[d]||i;return t?o.createElement(g,r(r({ref:n},m),{},{components:t})):o.createElement(g,r({ref:n},m))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var c=2;c<i;c++)r[c]=t[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},22981:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>f,contentTitle:()=>d,default:()=>C,frontMatter:()=>p,metadata:()=>g,toc:()=>_});var o=t(3905),a=Object.defineProperty,i=Object.defineProperties,r=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,m=(e,n,t)=>n in e?a(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,u=(e,n)=>{for(var t in n||(n={}))s.call(n,t)&&m(e,t,n[t]);if(l)for(var t of l(n))c.call(n,t)&&m(e,t,n[t]);return e};const p={id:"migration",title:"Migration Information",sidebar_label:"Migration Information"},d=void 0,g={unversionedId:"migration",id:"migration",title:"Migration Information",description:"Adding new features can require to adapt the existing configuration of the Pro Mosquitto and MMC setups. This page documents possible configuration and setup changes. While updating your on-premise setups please refer to this document. Cloud customers are updated automatically.",source:"@site/mosquitto/migration.md",sourceDirName:".",slug:"/migration",permalink:"/documentation-staging/mosquitto/next/migration",draft:!1,tags:[],version:"current",frontMatter:{id:"migration",title:"Migration Information",sidebar_label:"Migration Information"},sidebar:"someSidebar",previous:{title:"Release Notes",permalink:"/documentation-staging/mosquitto/next/release-notes"}},f={},_=[{value:"Single Node",id:"single-node",level:2},{value:"Docker Compose",id:"docker-compose",level:3},{value:"Example:",id:"example",level:3},{value:"Features",id:"features",level:2}],O={toc:_};function C(e){var n,t=e,{components:a}=t,m=((e,n)=>{var t={};for(var o in e)s.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&l)for(var o of l(e))n.indexOf(o)<0&&c.call(e,o)&&(t[o]=e[o]);return t})(t,["components"]);return(0,o.kt)("wrapper",(n=u(u({},O),m),i(n,r({components:a,mdxType:"MDXLayout"}))),(0,o.kt)("p",null,"Adding new features can require to adapt the existing configuration of the Pro Mosquitto and MMC setups. This page documents possible configuration and setup changes. While updating your on-premise setups please refer to this document. Cloud customers are updated automatically. "),(0,o.kt)("h1",u({},{id:"27"}),"2.7"),(0,o.kt)("h2",u({},{id:"single-node"}),"Single Node"),(0,o.kt)("p",null,"This is the Docker Migration guide to upgrade from version 2.6 to 2.7."),(0,o.kt)("h3",u({},{id:"docker-compose"}),"Docker Compose"),(0,o.kt)("p",null,"1) Add the following environment variable to the management center:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PROXY_HOST: 0.0.0.0\n")),(0,o.kt)("p",null,"2) If you are going to use Audit Trail, add the following variables:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"      CEDALO_HOST_NAME: ${CEDALO_HOST_NAME}\n      CEDALO_IP_ADDRESS: ${CEDALO_IP_ADDRESS}\n      CEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL: /management-center/config/audit.json\n")),(0,o.kt)("p",null,"Note that if you have ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_DATA_DIRECTORY_PATH")," specified, you don't have to set ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL")," as well, but specifying it explicitly is a good idea.\n",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_HOST_NAME")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_IP_ADDRESS")," should be provided before running ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," (they will be automatically set when running with ",(0,o.kt)("inlineCode",{parentName:"p"},"start.sh")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"start.bat"),"). These variables will display hostname and ip address of the mmc application in the syslog entries.\n3) If you want to use audit-trail and you should additionally specify the following mount if you want your container to direct the syslogs into the hostmachine's ",(0,o.kt)("inlineCode",{parentName:"p"},"/dev/log")," unix socket:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"volumes:\n    # other volumes here...\n    - /dev/log:/dev/log\n")),(0,o.kt)("p",null,"4) You may remove the following variable from the docker-compose as it's no longer being used:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"      CEDALO_MC_PLUGIN_DIR: /management-center/plugins\n")),(0,o.kt)("p",null,"5) Optionally, if you want to specify some specific set of plugins to load, you can do so via the ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_PLUGIN_LIST_PATH")," environment variable:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),'        CEDALO_MC_PLUGIN_LIST_PATH: management-center/config/plugins.json"\n')),(0,o.kt)("p",null,"You should provide a path to ",(0,o.kt)("inlineCode",{parentName:"p"},"plugins.json")," user data file with the list of plugins to load. It can look like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-json"}),'{\n    "plugins": [\n        {\n            "id": "audit-trail"\n        },\n        {\n            "id": "user-management"\n        },\n        {\n            "id": "cert-management"\n        },\n        {\n            "id": "saml-sso"\n        },\n        {\n            "id": "https"\n        },\n        {\n            "id": "application-tokens"\n        },\n        {\n            "id": "monitoring-rest-api"\n        },\n        {\n            "id": "tls"\n        },\n        {\n            "id": "user-profile-edit"\n        },\n        {\n            "id": "cluster-management"\n        },\n        {\n            "id": "connections-rest-api"\n        },\n        {\n            "id": "custom-themes"\n        },\n        {\n            "id": "multiple-connections"\n        },\n        {\n            "id": "system-status-rest-api"\n        },\n        {\n            "id": "topictree-rest-api"\n        },\n        {\n            "id": "dynamic-security-rest-api"\n        }\n    ]\n}\n')),(0,o.kt)("p",null,"6) Make sure that the ",(0,o.kt)("inlineCode",{parentName:"p"},"command")," section is changed from the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"    command: >\n      /bin/sh -c \"\n        while ! nc -z mosquitto 1883;\n        do\n          echo 'Waiting for mosquitto';\n          sleep 1;\n        done;\n        cd /management-center; exec /bin/sh /management-center/docker-entrypoint.sh ./start\n      \"\n")),(0,o.kt)("p",null,"to:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"    command: >\n      /bin/sh -c \"\n        while ! nc -z mosquitto 1883;\n        do\n          echo 'Waiting for mosquitto';\n          sleep 1;\n        done;\n        cd /management-center; exec ./mmc\n      \"\n")),(0,o.kt)("p",null,"So the line which changes is ",(0,o.kt)("inlineCode",{parentName:"p"},"cd /management-center; exec /bin/sh /management-center/docker-entrypoint.sh ./start")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"cd /management-center; exec ./mmc"),"\n7) Change MMC image to:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"image: registry.cedalo.com/mosquitto/management-center:2.7\n")),(0,o.kt)("p",null,"and Mosquitto image to:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"image: registry.cedalo.com/mosquitto/mosquitto:2.7\n")),(0,o.kt)("p",null,"8) Place your license to where ",(0,o.kt)("inlineCode",{parentName:"p"},"/management-center/config")," or a different location where ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_LICENSE_PATH")," environment variable is pointing to. For a new license which also covers 2.7 features please contact our team. "),(0,o.kt)("h3",u({},{id:"example"}),"Example:"),(0,o.kt)("p",null,"Here is a sample docker-compose file for 2.7 MMC:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),'version: "3.7"\nservices:\n  mosquitto:\n    image: registry.cedalo.com/development/mosquitto:2.7.0-rc1\n    ports:\n      - 1883:1883\n      - 8883:8883\n      - 8090:8090\n    networks:\n      - cedalo-platform\n    environment:\n      CEDALO_LICENSE_FILE: /mosquitto/license/license.lic\n    volumes:\n      - ./mosquitto/config:/mosquitto/config\n      - ./mosquitto/data:/mosquitto/data\n      - ./management-center/config/:/mosquitto/license/\n  management-center:\n    image: registry.cedalo.com/development/management-center-premium:2.7.0-rc1\n    ports:\n      - 8088:8088\n    expose:\n     - 8088\n    depends_on:\n      - mosquitto\n    networks:\n      - cedalo-platform\n    environment:\n      CEDALO_HOST_NAME: ${CEDALO_HOST_NAME}\n      CEDALO_IP_ADDRESS: ${CEDALO_IP_ADDRESS}\n      CEDALO_MC_PROXY_HOST: 0.0.0.0\n      CEDALO_MC_USERNAME: cedalo\n      CEDALO_MC_PASSWORD: mmcisawesome\n      CEDALO_MC_PROXY_SRT_BASE: /management-center/config\n      CEDALO_MC_LICENSE_PATH: /management-center/config/license.lic\n      # CEDALO_MC_PLUGIN_LIST_PATH: /management-center/config/plugins.json\n      CEDALO_MC_PROXY_CONFIG: /management-center/config/config.json\n      CEDALO_MC_PROXY_CONFIG_CERTS: /management-center/config/certs.db\n      CEDALO_MC_PROXY_CONFIG_TOKENS: /management-center/config/tokens.json\n      CEDALO_MC_PROXY_CONFIG_USERS: /management-center/config/users.json\n      CEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL: /management-center/config/audit.json\n      CEDALO_MC_BROKER_CONNECTION_MQTT_EXISTS_MAPPING: mosquitto:true\n      CEDALO_MC_BROKER_CONNECTION_MQTTS_EXISTS_MAPPING: mosquitto:false\n      CEDALO_MC_BROKER_CONNECTION_WS_EXISTS_MAPPING: mosquitto:false\n      CEDALO_MC_BROKER_CONNECTION_HOST_MAPPING: mosquitto:localhost\n      CEDALO_MC_DATA_DIRECTORY_PATH: /management-center/config\n      CEDALO_MC_MODE: offline\n    volumes:\n      - ./management-center/config:/management-center/config\n      # map unix socket for audit trail:\n      - /dev/log:/dev/log\n    command: >\n      /bin/sh -c "\n        while ! nc -z mosquitto 1883;\n        do\n          echo \'Waiting for mosquitto\';\n          sleep 1;\n        done;\n        cd /management-center; exec ./mmc\n      "\nnetworks:\n  cedalo-platform:\n    name: cedalo-platform\n    driver: bridge\n')),(0,o.kt)("h2",u({},{id:"features"}),"Features"),(0,o.kt)("p",null,"The new version added new features, which are not active by default. As usual, features are implemented via plugins, which can be turned off and on in the configuration files of the Management Center and Mosquitto. Loading plugins, which are not used can increase resources needed. This is why certain plugins need activation. To active new 2.7 features please see their documentation."))}C.isMDXComponent=!0}}]);